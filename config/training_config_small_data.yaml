# ============================================================
# Small-Data Training Configuration
# ============================================================
# Optimized for:
# - 10–50 images per category
# - Transfer learning
# - Heavy augmentation
# - Explainability compatibility (Grad-CAM)
# ============================================================

experiment:
  name: "small_data_transfer_learning"
  version: "v1.0"
  description: "Few-shot material classification with aggressive augmentation"

# ------------------------------------------------------------
# Dataset Settings
# ------------------------------------------------------------
dataset:
  mode: "small_data"              # enables small_data_loader
  image_size: [224, 224]
  min_images_per_class: 10
  max_images_per_class: null      # no cap
  augmentation_multiplier: 25     # 10 images → 250 samples

  splits:
    train: 0.7
    validation: 0.15
    test: 0.15

# ------------------------------------------------------------
# Data Augmentation (AGGRESSIVE)
# ------------------------------------------------------------
augmentation:
  enabled: true

  geometric:
    rotation_deg: 30
    horizontal_flip: true
    vertical_flip: true
    zoom_range: [0.8, 1.2]
    perspective_transform: true
    random_crop: true

  photometric:
    brightness: 0.3
    contrast: 0.3
    saturation: 0.25
    hue: 0.05
    gaussian_noise_std: 0.02

  regularization:
    cutout:
      enabled: true
      num_holes: 1
      hole_size_ratio: 0.3

    random_erasing:
      enabled: true
      probability: 0.5

  validation_augmentation:
    enabled: true
    rotation_deg: 10
    brightness: 0.1
    contrast: 0.1

# ------------------------------------------------------------
# Model Configuration
# ------------------------------------------------------------
model:
  architecture: "transfer_learning"
  backbone: "mobilenetv2"        # best for small data
  pretrained: true
  input_channels: 3

  freeze:
    backbone: true               # Stage 1
    batchnorm_layers: true

  unfreeze_strategy:
    stage_2:
      unfreeze_last_n_layers: 10
      min_images_per_class: 30

    stage_3:
      unfreeze_entire_backbone: true
      min_images_per_class: 50

# ------------------------------------------------------------
# Classification Head (SMALL DATA SAFE)
# ------------------------------------------------------------
classifier_head:
  hidden_layers: [256, 128]
  activation: "relu"
  dropout:
    enabled: true
    rates: [0.6, 0.5]             # aggressive dropout
  batch_norm: true
  l2_regularization: 0.0005

# ------------------------------------------------------------
# Loss Function
# ------------------------------------------------------------
loss:
  type: "focal_loss"              # critical for small data
  focal_loss:
    gamma: 2.0
    alpha: 0.25
  class_weights: true             # auto-computed from dataset

# ------------------------------------------------------------
# Training Hyperparameters
# ------------------------------------------------------------
training:
  epochs: 30
  batch_size: 8                   # small batch = better generalization
  learning_rate: 0.0003
  weight_decay: 0.0005
  optimizer: "adam"

  mixed_precision: true

# ------------------------------------------------------------
# Learning Rate Scheduling
# ------------------------------------------------------------
scheduler:
  type: "reduce_on_plateau"
  factor: 0.3
  patience: 5
  min_lr: 0.000001

# ------------------------------------------------------------
# Early Stopping
# ------------------------------------------------------------
early_stopping:
  enabled: true
  monitor: "val_loss"
  patience: 20                    # high patience for noisy val sets
  min_delta: 0.0005

# ------------------------------------------------------------
# Progressive Training Control
# ------------------------------------------------------------
progressive_training:
  enabled: true
  auto_advance: true
  metric: "val_accuracy"
  improvement_threshold: 0.02     # 2% improvement required

# ------------------------------------------------------------
# Explainability Compatibility
# ------------------------------------------------------------
explainability:
  gradcam:
    enabled: true
    target_layer: "features"      # MobileNetV2 compatible
  store_attention_maps: false

# ------------------------------------------------------------
# Logging & Checkpoints
# ------------------------------------------------------------
logging:
  log_dir: "logs/training_small_data"
  log_frequency: 1

checkpointing:
  enabled: true
  save_best_only: true
  metric: "val_accuracy"
  dir: "models/saved_models"
  filename: "small_data_v1.0.pth"

# ------------------------------------------------------------
# Hardware
# ------------------------------------------------------------
hardware:
  device: "auto"                  # cpu / cuda
  num_workers: 2
  pin_memory: true
